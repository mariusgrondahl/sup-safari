"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _lodashEs = require("lodash-es");

var _getLanguage = require("../helpers/getLanguage");

var _getLanguage2 = _interopRequireDefault(_getLanguage);

var _determineProminentWords = require("../stringProcessing/determineProminentWords");

var _getSubheadings = require("../stringProcessing/getSubheadings");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Retrieves the prominent words from the given paper.
 *
 * @param {Paper} paper The paper to determine the prominent words of.
 * @param {Researcher} researcher The researcher to use for analysis.
 *
 * @returns {WordCombination[]} Prominent words for this paper, filtered and sorted.
 */
function getProminentWordsForInternalLinking(paper, researcher) {
	const text = paper.getText();
	const language = (0, _getLanguage2.default)(paper.getLocale());
	const morphologyData = (0, _lodashEs.get)(researcher.getData("morphology"), language, false);

	const subheadings = (0, _getSubheadings.getSubheadingsTopLevel)(text).map(subheading => subheading[2]);
	const attributes = [paper.getKeyword(), paper.getSynonyms(), paper.getTitle(), paper.getDescription(), subheadings.join(" ")];

	const abbreviations = (0, _determineProminentWords.retrieveAbbreviations)(text.concat(attributes.join(" ")));

	const prominentWordsFromText = (0, _determineProminentWords.getProminentWords)((0, _getSubheadings.removeSubheadingsTopLevel)(text), abbreviations, language, morphologyData);

	const prominentWordsFromPaperAttributes = (0, _determineProminentWords.getProminentWordsFromPaperAttributes)(attributes, abbreviations, language, morphologyData);

	/*
  * If a word is used in any of the attributes, its weight is automatically high.
  * To make sure the word survives weight filters and gets saved in the database, make the number of occurrences times-3.
  */
	prominentWordsFromPaperAttributes.forEach(relevantWord => relevantWord.setOccurrences(relevantWord.getOccurrences() * 3));

	const collapsedWords = (0, _determineProminentWords.collapseProminentWordsOnStem)(prominentWordsFromPaperAttributes.concat(prominentWordsFromText));
	(0, _determineProminentWords.sortProminentWords)(collapsedWords);

	/*
  * Return the 100 top items from the collapsed and sorted list. The number is picked deliberately to prevent larger
  * articles from getting too long of lists.
  *
  * Minimum required occurrences set to 4 in order to avoid premature suggestions of words fro  the paper attributes.
  * These get a times-3 boost and would therefore be prominent with just 1 occurrence.
  */
	return (0, _lodashEs.take)((0, _determineProminentWords.filterProminentWords)(collapsedWords, 4), 100);
}

exports.default = getProminentWordsForInternalLinking;
//# sourceMappingURL=getProminentWordsForInternalLinking.js.map
